<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LITV IPTV 直播源生成器（最终修复版）</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:-apple-system, BlinkMacSystemFont, "PingFang SC", Arial, sans-serif;}
        body {background:#f5f5f5;padding:20px;max-width:100%;}
        .container {max-width:800px;margin:0 auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);}
        h1 {font-size:20px;color:#333;text-align:center;margin-bottom:20px;font-weight:600;}
        .btn-group {display:flex;gap:10px;margin-bottom:25px;flex-wrap:wrap;}
        button {flex:1;padding:12px;border:none;border-radius:8px;background:#1677ff;color:#fff;cursor:pointer;font-size:14px;transition:all 0.2s;}
        button:hover {opacity:0.9;}
        button.gray {background:#666;}
        textarea {width:100%;height:300px;padding:15px;border:1px solid #ddd;border-radius:8px;font-size:12px;line-height:1.5;resize:vertical;margin-bottom:15px;background:#fafafa;}
        .channel-list {max-height:200px;overflow-y:auto;border:1px solid #eee;border-radius:8px;margin-bottom:20px;}
        .channel-item {padding:10px 15px;border-bottom:1px solid #f5f5f5;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
        .channel-item:last-child {border-bottom:none;}
        .channel-item:hover {background:#e8f4ff;}
        .channel-name {font-size:14px;color:#333;}
        .channel-id {font-size:12px;color:#666;font-family:monospace;}
        .tip {font-size:12px;color:#999;text-align:center;margin-top:10px;line-height:1.6;}
        .warning {background:#fff2f2;color:#ff4d4f;padding:10px 15px;border-radius:8px;font-size:12px;margin-bottom:20px;line-height:1.5;}
    </style>
</head>
<body>
    <div class="container">
        <h1>LITV IPTV 直播源生成器（最终修复版）</h1>
        <div class="warning">⚠️ 重要提示：生成的直播源有效期约15分钟，请及时导入播放器！若无法播放，重新生成即可（流地址实时更新）。</div>
        <div class="btn-group">
            <button onclick="generateFullM3U()">生成完整 M3U 播放列表</button>
            <button onclick="copyResult()" class="gray">复制结果</button>
            <button onclick="downloadResult()" class="gray">下载文件</button>
        </div>
        <div class="channel-list" id="channelList"></div>
        <textarea id="resultArea" placeholder="生成的播放源内容会显示在这里..."></textarea>
        <div class="tip">
            1. 点击频道可生成单个频道的 M3U8 地址（直接可用）<br>
            2. 完整 M3U 列表可直接导入 IPTV 播放器（如 VLC、Kodi、Perfect Player）<br>
            3. 无需后端服务器，纯前端实时生成，流地址15分钟内有效
        </div>
    </div>
    <script>
        const CHANNELS = {
            "4gtv-4gtv002":[1,11,"民視"],
            "4gtv-4gtv003":[1,7,"民視第一台"],
            "litv-ftv13":[1,7,"民視新聞台"],
            "4gtv-4gtv001":[1,7,"民視台灣台"],
            "litv-ftv09":[1,6,"民視影劇台"],
            "litv-ftv07":[1,6,"民視旅遊台"],
            "4gtv-4gtv004":[1,9,"民視綜藝台"],
            "4gtv-4gtv040":[1,7,"中視"],
            "4gtv-4gtv074":[1,6,"中視新聞台"],
            "4gtv-4gtv009":[2,9,"中天新聞台"]
        };
        window.onload = () => renderChannelList();
        function renderChannelList() {
            const listEl = document.getElementById('channelList');
            let html = '';
            for (const [id, [qlt, alt, name]] of Object.entries(CHANNELS)) {
                html += `<div class="channel-item" onclick="generateSingleChannel('${id}')"><span class="channel-name">${name}</span><span class="channel-id">${id}</span></div>`;
            }
            listEl.innerHTML = html;
        }
        function generateSingleChannel(id) {
            const [qlt, alt, name] = CHANNELS[id];
            const now = Date.now()/1000;
            const timestamp = Math.floor(now/4-355017628); // 修复时间戳算法
            const t = timestamp * 4;
            let m3u8 = "#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:4\n#EXT-X-MEDIA-SEQUENCE:" + timestamp + "\n";
            let currentTs = timestamp;
            let currentT = t;
            for (let i=0; i<20; i++) { // 生成20个TS片段，延长播放时间
                m3u8 += "#EXTINF:4,\n";
                m3u8 += `https://ntd-tgc.cdn.hinet.net/live/pool/${id}/litv-pc/${id}-avc1_6000000=${qlt}-mp4a_134000_zho=${alt}-begin=${currentT}0000000-dur=40000000-seq=${currentTs}.ts\n`;
                currentTs++;
                currentT +=4;
            }
            document.getElementById('resultArea').value = m3u8;
            alert(`已生成【${name}】的 M3U8 播放流（15分钟内有效）`);
        }
        function generateFullM3U() {
            let m3u = "#EXTM3U\n";
            const now = Date.now()/1000;
            for (const [id, [qlt, alt, name]] of Object.entries(CHANNELS)) {
                const timestamp = Math.floor(now/4-355017628);
                const t = timestamp * 4;
                const m3u8Url = `https://ntd-tgc.cdn.hinet.net/live/pool/${id}/litv-pc/${id}-avc1_6000000=${qlt}-mp4a_134000_zho=${alt}-begin=${t}0000000-dur=40000000-seq=${timestamp}.m3u8`;
                m3u += `#EXTINF:-1 tvg-id="${id}" tvg-name="${name}" group-title="LITV系列",${name}\n${m3u8Url}\n`;
            }
            document.getElementById('resultArea').value = m3u;
            alert(`已生成完整M3U播放列表（共${Object.keys(CHANNELS).length}个频道，15分钟内有效）`);
        }
        function copyResult() {
            const textarea = document.getElementById('resultArea');
            if (!textarea.value) {alert('暂无内容可复制！');return;}
            textarea.select();
            navigator.clipboard.writeText(textarea.value).then(() => alert('复制成功！请立即导入播放器')).catch(() => {document.execCommand('copy');alert('复制成功！请立即导入播放器');});
        }
        function downloadResult() {
            const textarea = document.getElementById('resultArea');
            if (!textarea.value) {alert('暂无内容可下载！');return;}
            const isM3U8 = textarea.value.includes('#EXT-X-MEDIA-SEQUENCE');
            const fileName = isM3U8 ? `channel_${Date.now()}.m3u8` : `litv_iptv_${Date.now()}.m3u`;
            const blob = new Blob([textarea.value], {type: isM3U8 ? 'application/vnd.apple.mpegurl' : 'application/octet-stream'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            alert(`已下载 ${fileName}（15分钟内有效，请立即导入）`);
        }
    </script>
</body>
</html>
